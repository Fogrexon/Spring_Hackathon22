const E=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))s(g);new MutationObserver(g=>{for(const o of g)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function A(g){const o={};return g.integrity&&(o.integrity=g.integrity),g.referrerpolicy&&(o.referrerPolicy=g.referrerpolicy),g.crossorigin==="use-credentials"?o.credentials="include":g.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(g){if(g.ep)return;g.ep=!0;const o=A(g);fetch(g.href,o)}};E();var S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAOoSURBVHgB7Z3LceMwEAXlLeWh2+awQW00G9Tm4GTs4mGqWDRACsRvMK/74IttmdRrDmhiAH28Xq+vB8jy3L78/vM3+wOf//89rn6mNx6OYRSjz/XXA6RBAHEQQBwEEAcBxEEAcRBAHAQQBwHEQQBxEEAcBBAHAcT5YDpYGyqAOJf9AL1YfY7f8/Hbse3JHScVIBBb8Pvw96GnpNh4PmB5juGWVCUqwMIcr/iNY/hXVYAKsCAlY7x9jyEgAKXB515j/zsIsAAtgs9VAQRwTIvgc69rr4MADukVfKoKIIAjegWf+1vbayOAA0YGf6wCCDCRkcHn/j4CTGB28PsqgAADmR186jjoB5jE7OANKsBgvARvTOsHuEOPOfizN6cl3oI3qACd8Rq8gQCd8B68gQCNWSV4AwEasVrwBgJUsmrwBgLcZPXgDQQoJErwBgK8SbTgDQS4IGrwBgJkiB68gQAHVII3LgUYcXBe5iJGH8fM4A1WBu0YFUhqRc8sLvsBel8VXt4Io+f5ejvXDSrAgR4hebrij2T7AVacJ6/tF2h9zj0XdrR6Lf4LSHBcP3fn9494bbpBgB1nq2jfYaXgDQTIUFIFVgze+CGA15uVUZRUgZWDN7IVYLUT6UGuCkQI3mAISJCrApGCNxDgDSIGb/AgKIMFnNqEKdLwGKICKE1YtSbUENA6JIUb4awAPa4q/rPwB/cA4gwdAtQfMnmE/QHEYQgQ59n6xqzHGv6ZRDufI1QAcRBAHAQQJ9xkUO4jUyBNqArAc4ZyQgiQa7tGiGuWHgLO5ukJ/z2WFKCkQaO2xTs6SwlQEnxti7cKSwhQ25JFFcjjWoDa4KkC17gUoEcTJlUgjSsBegRPFTjHbT/AijuCr4g7AXp+Shb8pEk/QIs3d9b47G29fivePabpj4JHLbTgBjDNtJtAxR25PDJcAIL3xTABCN4n3QUgeN90E4Dg16BKAA/r5gm+jlsCEHwcigVIbZgwEoJvy+0hgOBjcPtJoOLO2hEpFmDUlU/wY6iaC1DbWTsi1dPBrSoCoc+hST9A6521YRzPWeGV9vaffX8kI45l5Pk2eRSssrN2RKoEUNtZOyLNJoMUdtaOSLUASjtrR6TpdHBuOCB4vzRpCj1boEn4vmlWAQh6TdgkShwEEAcBxEEAcRBAHAQQh88LEIcKIM6zdBpXZU6+N17OgQogDgKIgwDiIIA4CCAOAoiDAOIggDgIIA4CiIMA4iCAOAggDv0A4nwDGWbBhUzQF78AAAAASUVORK5CYII=",R="/assets/gameover.71c6430d.png",p="/assets/ghost.3a9094a8.png",M="data:image/png;base64,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",Q="/assets/player.22b49827.png",U="/assets/result.06168fae.png",b="/assets/title.6fc219c1.png",x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAESSURBVHgB7dyxSUNRGIbhP5IFBCtLiyxha5EtHMB5HMAtUti6RApLK8ERFC4ngq7wvE9zkjLw8hEuh7ubme8J62pC218+vJ/PI7k7HP58V39/C4ArAFwB4AoAVwC4AsAVAK4AcAWAKwBcAeAKAFcAuALAFQCuAHD7yeb/BRFFC4ArAFwB4PoPsDw+3Yzk5flzO1sAXAHgCgBXALgCwBUArgBwBYArAFwB4AoAVwC4AsAVAK4AcAWA2816T6D+ljBVC4DrStjyejqN5OF43M4WAFcAuALAFQCuAHAFgCsAXAHgehC0XB6MaFoAXAuwXN/ej+Tr4207WwBcAeAKAFcAuALAFQCuAHAFgPu9FRxTC4D7AdmVFsm2ZkGzAAAAAElFTkSuQmCC",H="/assets/item.3a8ace43.png";const l=e=>{const r=new Image;return r.src=e,r},L={floor:l(S),gameover:l(R),ghost:l(p),heartAnimation:l(M),player:l(Q),result:l(U),title:l(b),wall:l(x),item:l(H)},u=e=>L[e],F=(e,r)=>Math.abs(Math.sin(e*12.9898+r*78.233)%1),N=(e,r)=>{const{data:A,width:s,height:g}=e,{width:o,height:c}=r.canvas,t=o/s,n=c/g;for(let i=0;i<g;i+=1)for(let w=0;w<s;w+=1){const m=A[i*s+w],v=i===g-1?".":A[(i+1)*s+w],Y=Math.floor(F(w,i)*4);m==="."?r.drawImage(u("floor"),Y%2*64,Math.floor(Y/2)*64,64,64,w*t,i*n,t,n):v==="#"?r.drawImage(u("wall"),0,0,64,64,w*t,i*n,t,n):r.drawImage(u("wall"),64,0,64,64,w*t,i*n,t,n)}for(let i=0;i<e.items.length;i+=1){const[w,m]=e.items[i];e.exist[i]&&r.drawImage(u("item"),64*(i%3)+64,0,64,64,w*t,m*n,t,n)}const[f,C]=e.post;r.drawImage(u("item"),0,0,64,64,f*t,C*n,t,n)},O={ArrowUp:[64,0,64,64],ArrowDown:[128,0,64,64],ArrowLeft:[0,0,64,64],ArrowRight:[192,0,64,64],None:[0,0,0,0]},G={student:64,monk:128,exorcist:0},j=(e,r,A)=>{const{x:s,y:g}=e,{width:o,height:c}=A.canvas,t=o/r.width,n=c/r.height,f=u("player"),[C,i,w,m]=O[e.forward];A.drawImage(f,C,G[e.shurui]+i,w,m,s*t,g*n,t,n)},P={gUp:[64,0,64,64],gDown:[128,0,64,64],gLeft:[0,0,64,64],gRight:[192,0,64,64],None:[0,0,0,0]},T={random:64,chase:128},a=(e,r,A)=>{const{gx:s,gy:g}=e,{width:o,height:c}=A.canvas,t=o/r.width,n=c/r.height,f=u("ghost"),[C,i,w,m]=P[e.gdirect];A.drawImage(f,C,T[e.gtype]+i,w,m,s*t,g*n,t,n)},d={mode:"title"},K={data:`
####################
#..................#
#.#######..#######.#
#.#..............#.#
#.#.#########.##.#.#
#.#.#..........#.#.#
#...#.##.#####.#...#
#.#.#.#......#.#.#.#
#.#...#.##.#...#.#.#
#.#.#.#.#..#.#.#.#.#
#.#.#.#.#..#.#.#.#.#
#.#.#...#.##.#...#.#
#.#.#.#......#.#.#.#
#...#.#####.##.#...#
#.#.#..........#.#.#
#.#.##.#########.#.#
#.#..............#.#
#.#######..#######.#
#..................#
#################### 
`.replace(/\n/g,""),width:20,height:20,items:[[3,3],[16,16],[18,1],[1,18]],exist:[!0,!0,!0,!0],post:[9,9]},W={data:`
####################
#..................#
#.#.##.#.#.##.#.##.#
#.#.#..#.#..#.#..#.#
#........##.#.##...#
#.###.##.#.......#.#
#.#...##...##.##.#.#
#.#.#....#.#.......#
#.#.#.#.##.#.###.#.#
#.#...#..#...#...#.#
#...#..#...#...###.#
#.####...#####.#...#
#...#..#.......#.#.#
#.#...##.#.###.#.#.#
#.#.#....#.#.......#
#...#.#.##.#.#####.#
#.###.#..........#.#
#.#...###.#.####.#.#
#..................#
####################
`.replace(/\n/g,""),width:20,height:20,items:[[1,1],[16,3],[3,17],[18,18]],exist:[!0,!0,!0,!0],post:[10,9]},V={data:`
####################
#.#........##.#....#
#.#.###.##....#.####
#.#.#...##.##......#
#.#.#.#.##.##.####.#
#...#...#........#.#
###.###...#.##.#...#
#.....#####.##.#####
#.###.....#.#......#
#.....###...###.##.#
#####..#...####.##.#
#......#.#......##.#
#.####.#.#####.....#
#...##.#.#...#.#.###
#.#......#.#.#.#...#
#.####.#.......#.#.#
#......#######.#.#.#
####.#.#....##.#.#.#
#....#...##......#.#
####################
`.replace(/\n/g,""),width:20,height:20,items:[[1,1],[18,1],[1,18],[18,18]],exist:[!0,!0,!0,!0],post:[10,9]},B={current:0,maps:[K,W,V]},J=()=>{B.current<B.maps.length-1?B.current+=1:d.mode="result"},z=()=>B.maps[B.current],q=()=>{for(let e=0;e<B.maps.length-1;e+=1)B.maps[e].exist=[!0,!0,!0,!0]},Z=(e,r)=>{for(let A=0;A<r.items.length;A+=1)if(e.preX===r.items[A][0]&&e.preY===r.items[A][1]&&e.have===0&&r.exist[A])return r.exist[A]=!1,A;return-1},k=(e,r)=>e.preX===r.post[0]&&e.preY===r.post[1],y=(e,r)=>e.x<r.gx+1&&r.gx<e.x+1&&e.y<r.gy+1&&r.gy<e.y+1,_=(e,r,A)=>{const s=(c,t)=>{const{width:n}=r;return r.data[t*n+c]!=="#"},g=Date.now()/1e3;let o=.1;switch(e.shurui){case"student":o=.07;break;case"monk":o=.11;break}if(g-e.start<o)e.x=(e.targetX-e.preX)*((g-e.start)/o)+e.preX,e.y=(e.targetY-e.preY)*((g-e.start)/o)+e.preY;else{switch(e.start=g,e.preX=e.targetX,e.preY=e.targetY,e.forward=e.direction==="None"?e.forward:e.direction,e.direction){case"ArrowUp":e.targetX=e.preX,e.targetY=e.preY-1;break;case"ArrowDown":e.targetX=e.preX,e.targetY=e.preY+1;break;case"ArrowLeft":e.targetX=e.preX-1,e.targetY=e.preY;break;case"ArrowRight":e.targetX=e.preX+1,e.targetY=e.preY;break}s(e.targetX,e.targetY)||(e.targetX=e.preX,e.targetY=e.preY),Z(e,r)!==-1&&e.have===0&&(e.have=1),k(e,r)&&(e.nouhin+=e.have,e.have=0),e.nouhin===r.items.length&&(e.nouhin=0,J())}for(let c=0;c<A.length;c+=1)y(e,A[c])&&(d.mode="result2")},$=e=>{window.addEventListener("keydown",r=>{if(e.preX=e.x,e.preY=e.y,d.mode==="game")switch(r.key){case"ArrowUp":e.direction="ArrowUp";break;case"ArrowDown":e.direction="ArrowDown";break;case"ArrowLeft":e.direction="ArrowLeft";break;case"ArrowRight":e.direction="ArrowRight";break}}),window.addEventListener("keyup",()=>{e.direction="None"})},D=(e,r)=>{e.x=10,e.y=10,e.targetX=10,e.targetY=10,e.preX=10,e.preY=10;for(let A=0;A<r.length;A+=1)r[A].gx=10,r[A].gy=10,r[A].gtargetX=5,r[A].gtargetY=5,r[A].gpreX=5,r[A].gpreY=5;q()},ee=e=>{const r=u("title"),{width:A,height:s}=e.canvas,g=r.width/r.height,o=(s*g-A)/2;e.drawImage(r,-o,0,s*g,s)},re=e=>{const r=u("result"),{width:A,height:s}=e.canvas,g=r.width/r.height,o=(s*g-A)/2;e.drawImage(r,-o,0,s*g,s),e.fillStyle="#ffffff",e.font='75px "Press Start 2P", sans-serif';const c="03",t="00";e.fillText(c,125,290),e.fillText(t,325,290)},te=e=>{const r=u("gameover"),{width:A,height:s}=e.canvas,g=r.width/r.height,o=(s*g-A)/2;e.drawImage(r,-o,0,s*g,s)},Ae=e=>{window.addEventListener("keydown",r=>{if(d.mode==="title")switch(r.key){case"1":e.shurui="monk",d.mode="game";break;case"2":e.shurui="exorcist",d.mode="game";break;case"3":e.shurui="student",d.mode="game";break}})},ge=()=>{window.addEventListener("keydown",e=>{d.mode==="result"&&(e.key===" "&&(d.mode="title"),e.key==="e"&&window.open(`https://twitter.com/intent/tweet?text=ConSoul\u3092${3}\u5206${3}\u79D2\u3067\u30AF\u30EA\u30A2\u3057\u307E\u3057\u305F\uFF01&hashtags=ConSoul`,"_blank"))})},ne=()=>{window.addEventListener("keydown",e=>{d.mode==="result2"&&e.key===" "&&(d.mode="title")})},h={left:Math.floor(Math.random()*-1e3),right:Math.floor(Math.random()*-1e3),up:Math.floor(Math.random()*-1e3),down:Math.floor(Math.random()*-1e3)},se=(e,r,A)=>{const s=(t,n,f)=>{I(n.gtargetX,n.gtargetY-1,f)||(t.up=1e4),I(n.gtargetX,n.gtargetY+1,f)||(t.down=1e4),I(n.gtargetX-1,n.gtargetY,f)||(t.left=1e4),I(n.gtargetX+1,n.gtargetY,f)||(t.right=1e4)},g=(t,n)=>{n.gdirect==="gUp"?t.down=9999:n.gdirect==="gDown"?t.up=9999:n.gdirect==="gLeft"?t.right=9999:n.gdirect==="gRight"&&(t.left=9999)},o=()=>{h.left=Math.floor(Math.random()*-1e3),h.right=Math.floor(Math.random()*-1e3),h.up=Math.floor(Math.random()*-1e3),h.down=Math.floor(Math.random()*-1e3)},c=(t,n)=>{Math.min(t.up,t.down,t.left,t.right)===t.up?n.gdirect="gUp":Math.min(t.up,t.down,t.left,t.right)===t.down?n.gdirect="gDown":Math.min(t.up,t.down,t.left,t.right)===t.left?n.gdirect="gLeft":Math.min(t.up,t.down,t.left,t.right)===t.right&&(n.gdirect="gRight")};switch(e.gtype){case"random":{o(),s(h,e,A),g(h,e),c(h,e);break}case"chase":{const t=e.gx-r.x,n=e.gy-r.y;h.up=t**2+(n-1)**2,h.down=t**2+(n+1)**2,h.left=(t-1)**2+n**2,h.right=(t+1)**2+n**2,s(h,e,A),g(h,e),c(h,e);break}default:throw new Error("Unknown GhostType")}},I=(e,r,A)=>{const{width:s}=A;return A.data[r*s+e]!=="#"},X=(e,r,A)=>{const s=Date.now()/1e3;if(s-e.gstart<e.ginterval)e.gx=(e.gtargetX-e.gpreX)*((s-e.gstart)/e.ginterval)+e.gpreX,e.gy=(e.gtargetY-e.gpreY)*((s-e.gstart)/e.ginterval)+e.gpreY;else{switch(se(e,A,r),e.gstart=s,e.gpreX=e.gtargetX,e.gpreY=e.gtargetY,e.gdirect){case"gUp":e.gtargetX=e.gpreX,e.gtargetY=e.gpreY-1;break;case"gDown":e.gtargetX=e.gpreX,e.gtargetY=e.gpreY+1;break;case"gLeft":e.gtargetX=e.gpreX-1,e.gtargetY=e.gpreY;break;case"gRight":e.gtargetX=e.gpreX+1,e.gtargetY=e.gpreY;break;default:throw new Error("ghostDirectionError\u3067\u3059")}I(e.gtargetX,e.gtargetY,r)||(e.gtargetX=e.gpreX,e.gtargetY=e.gpreY)}},oe=e=>{e.save();const{width:r,height:A}=e.canvas;e.translate((r-A)/2,0),e.scale(A/r,1)},ce=e=>{e.restore()},ie=(e,r)=>{oe(e),r(),ce(e)},we=()=>{const e=document.getElementById("cnv");if(!e)throw new Error("Canvas not found");const r=e.getContext("2d");if(!r)throw new Error("Canvas context not found");const A={x:10,y:10,direction:"None",forward:"ArrowRight",targetX:10,targetY:10,preX:1,preY:1,start:Date.now()/1e3,have:0,nouhin:0,shurui:"student"},s={gtype:"random",gx:5,gy:5,gdirect:"gNone",ginterval:.5,gtargetX:5,gtargetY:5,gpreX:5,gpreY:5,gstart:Date.now()/1e3},g={gtype:"chase",gx:5,gy:5,gdirect:"gNone",ginterval:.5,gtargetX:5,gtargetY:5,gpreX:5,gpreY:5,gstart:Date.now()/1e3};let o="title";$(A),Ae(A),ge(),ne();const c=()=>{requestAnimationFrame(c),r.clearRect(0,0,e.width,e.height);const t=z();switch(d.mode){case"title":{ee(r);break}case"game":o==="title"&&D(A,[s,g]),X(s,t,A),X(g,t,A),_(A,t,[s,g]),ie(r,()=>{N(t,r),j(A,t,r),a(s,t,r),a(g,t,r)});break;case"result":re(r);break;case"result2":te(r);break;default:throw new Error("Unknown mode")}o=d.mode};c()};we();
